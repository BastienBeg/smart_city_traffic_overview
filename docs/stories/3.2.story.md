# Story 3.2: Mission Control Dashboard Layout

## Status
Done

## Story
**As a** City Operator,
**I want** to see a grid of all active cameras and a live event log on a single screen,
**So that** I have immediate situational awareness.

## Acceptance Criteria
1. [x] Responsive Grid Layout (scales from 1x1 to 4x4).
2. [x] Sidebar Navigation (Mission Control, Map, Triage, Settings).
3. [x] "Event Log" panel on the right side.
4. [x] Empty states defined for "No Cameras" or "No Events".

## Tasks / Subtasks

- [x] **Task 1: Create Responsive Video Grid Component** (AC: 1)
  - [x] Create `src/components/ui/VideoGrid.tsx` component.
  - [x] Implement CSS Grid layout that scales from 1x1 to 4x4 based on camera count.
  - [x] Add responsive breakpoints: 1x1 (1 camera), 2x2 (2-4), 3x3 (5-9), 4x4 (10-16).
  - [x] Integrate placeholder `StreamCard` component for each grid cell.
  - [x] Handle dynamic grid resizing on window resize.

- [x] **Task 2: Enhance Sidebar Navigation** (AC: 2)
  - [x] Refactor `src/components/layout/Sidebar.tsx` if needed to add routing.
  - [x] Ensure navigation items link to: Mission Control (`/`), Map (`/map`), Triage (`/triage`), Pipeline (`/pipeline`), Settings (`/settings`).
  - [x] Add active state highlighting for current route.
  - [x] Add notification badge placeholder on Triage icon.

- [x] **Task 3: Create StreamCard Component** (AC: 1)
  - [x] Create `src/components/ui/StreamCard.tsx`.
  - [x] Props: `cameraId`, `name`, `status` (Live/Offline/Alert).
  - [x] Display camera name overlay (bottom-left).
  - [x] Add status indicator (colored border: green for live, red for alert, gray for offline).
  - [x] Implement hover state with "Expand" button (functionality deferred to future story).

- [x] **Task 4: Create Event Log Panel** (AC: 3)
  - [x] Create `src/components/ui/EventLog.tsx` component.
  - [x] Display scrolling list of events with: timestamp, camera name, event type.
  - [x] Implement auto-scroll to bottom behavior.
  - [x] Pause auto-scroll on hover.
  - [x] Style with muted text for timestamps, primary text for camera names.

- [x] **Task 5: Implement Empty States** (AC: 4)
  - [x] Create `src/components/ui/EmptyState.tsx` reusable component.
  - [x] Props: `icon`, `title`, `description`.
  - [x] "No Cameras" empty state for VideoGrid: Icon + "No Active Cameras" + "Add cameras from the Map screen."
  - [x] "No Events" empty state for EventLog: Icon + "No Events Yet" + "Detection events will appear here."

- [x] **Task 6: Compose Mission Control Page** (AC: 1, 2, 3, 4)
  - [x] Update `src/app/page.tsx` to use VideoGrid, EventLog components.
  - [x] Implement 3-column layout: Sidebar (5%), VideoGrid (75%), EventLog (20%).
  - [x] Add mock data for testing (3-4 fake cameras, 5-10 fake events).
  - [x] Ensure responsive behavior on different screen sizes.

- [x] **Task 7: Verify Build and Visual** (AC: 1, 2, 3, 4)
  - [x] Run `npm run build` to verify no TypeScript errors.
  - [x] Run `npm run lint` to verify ESLint passes.
  - [x] Visual verification of layout at 1080p and 1440p resolutions.

## Dev Notes

### Previous Story Insights
Story 3.1 established the Next.js foundation with:
- TailwindCSS v4 using `@theme inline` directive in `globals.css`
- Sidebar component with 5% width and navigation icons
- CSS custom properties for Cyberpunk color palette
[Source: Story 3.1 Completion Notes]

### Visual Design Specifications

**Color Palette** (Cyberpunk Modern):
| Color | Hex | Usage |
|-------|-----|-------|
| Background | `#050510` | Main background |
| Surface | `#1A1A2E` | Card backgrounds, panels |
| Primary (Neon) | `#00F0FF` | Active elements, selection borders |
| Success | `#00FF94` | Healthy states, "Live" status |
| Alert (Danger) | `#FF2A6D` | Critical anomalies, "Alert" status |
| Warning | `#FFC857` | High latency, potential issues |
| Text Primary | `#EAEAEA` | Main content |
| Text Muted | `#8892B0` | Metadata, timestamps |
[Source: front-end-spec.md#6.2]

**Typography**:
- Font Family: `Inter` (already configured in Story 3.1)
- Bold (700): KPI Numbers, Alert Headers
- Medium (500): Button labels, Navigation
- Regular (400): Logs, Body text
[Source: front-end-spec.md#6.3]

### Layout Specifications

**Mission Control Layout**:
- Left Rail (5%): Navigation Icons + Notifications (implemented in 3.1)
- Center Grid (75%): Video Grid (responsive 2x2 to 6x6)
- Right Panel (20%): Live Event Log
[Source: front-end-spec.md#4.1]

**Grid States**:
- Normal: Clean video feed, minimal overlays (Location Name)
- Hover: Show "Expand" button
- Alert: Red pulsing border
[Source: front-end-spec.md#4.1]

### Component Specifications

**StreamCard Component**:
- Props: `streamUrl`, `status` (Live/Offline/Alert), `labelMode` (Hidden/Visible)
- Behavior: Lazy loads HLS stream (deferred). On hover, shows actions.
[Source: front-end-spec.md#5.1]

**LogStream (EventLog) Component**:
- Props: `events[]`
- Behavior: Auto-scrolls to bottom. Pauses scroll on hover.
[Source: front-end-spec.md#5.1]

### File Locations
```text
services/web-dashboard/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx           # Mission Control page (modify)
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout/            # Sidebar, MainLayout (existing)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/                # NEW: VideoGrid, StreamCard, EventLog, EmptyState
‚îÇ   ‚îî‚îÄ‚îÄ lib/                   # Utilities (existing)
‚îî‚îÄ‚îÄ package.json
```
[Source: source-tree.md]

### Technical Constraints
- ESLint for linting, Prettier for formatting [Source: coding-standards.md]
- TypeScript strict mode required [Source: coding-standards.md]
- Functional components with hooks [Source: coding-standards.md]
- State management: React Context or Zustand [Source: coding-standards.md]
- Interaction Response: Hover states must render within 100ms [Source: front-end-spec.md#7]

### Testing
- **Test Location**: `services/web-dashboard/tests/` or component-level `__tests__/`
- No specific testing strategy document found - follow standard Next.js testing patterns with Jest/React Testing Library.

## Verification Plan

### Automated
- `npm run build` completes without errors.
- `npm run lint` shows no ESLint violations.

### Manual
- Open `http://localhost:3000` in browser.
- Verify VideoGrid displays mock cameras in responsive grid (resize window to test breakpoints).
- Verify EventLog panel on right side with scrolling behavior.
- Verify empty states appear when no cameras/events.
- Verify hover states on StreamCard components.
- Test at 1080p and 1440p resolutions.

## File List

| File | Action | Description |
|------|--------|-------------|
| `src/components/ui/VideoGrid.tsx` | Created | Responsive grid component (1x1 to 4x4) |
| `src/components/ui/StreamCard.tsx` | Created | Camera card with status indicator and hover |
| `src/components/ui/EventLog.tsx` | Created | Auto-scrolling event log panel |
| `src/components/ui/EmptyState.tsx` | Created | Reusable empty state component |
| `src/app/page.tsx` | Modified | Mission Control page composition |

## Completion Notes

- All UI components implemented with Cyberpunk color palette
- VideoGrid dynamically adjusts columns based on camera count
- EventLog auto-scrolls to bottom, pauses on hover
- Empty states display when no cameras or events
- Live event simulation added with mock data
- Visual verification passed at responsive breakpoints

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-16 | 1.0 | Initial draft | SM Agent (Bob) |
| 2026-01-16 | 2.0 | Implementation complete | Dev Agent (James) |

## QA Results

### Review Date: 2026-01-16

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: EXCELLENT** üåü

The implementation of Story 3.2 demonstrates high-quality frontend development with clean, well-structured React components. The code follows modern best practices including:

- **Type Safety**: Excellent TypeScript usage with proper interfaces (`Camera`, `DetectionEvent`, `CameraStatus`, `EventType`)
- **Component Architecture**: Clean separation of concerns with reusable UI components (`VideoGrid`, `StreamCard`, `EventLog`, `EmptyState`)
- **State Management**: Appropriate use of React hooks (`useState`, `useEffect`, `useRef`) for local state
- **Responsive Design**: Grid system dynamically adjusts columns based on camera count and viewport size
- **UX Polish**: Auto-scroll behavior with pause-on-hover, resume button, and visual feedback

### Refactoring Performed

None required - the code quality is excellent as implemented.

### Compliance Check

- Coding Standards: ‚úì ESLint/Prettier compliance, TypeScript strict mode
- Project Structure: ‚úì Components in `src/components/ui/` as specified in source-tree.md
- Testing Strategy: ‚ö†Ô∏è No unit tests created (acceptable for UI components in MVP phase)
- All ACs Met: ‚úì All 4 acceptance criteria fully implemented

### Requirements Traceability

| AC | Requirement | Implementation | Verified |
|----|-------------|----------------|----------|
| 1 | Responsive Grid Layout (1x1 to 4x4) | `VideoGrid.tsx` with `getGridColumns()` function | ‚úì |
| 2 | Sidebar Navigation | `Sidebar.tsx` with 5 navigation items + active state | ‚úì |
| 3 | Event Log panel | `EventLog.tsx` with auto-scroll and pause behavior | ‚úì |
| 4 | Empty states | `EmptyState.tsx` with `NoCamerasEmptyState` and `NoEventsEmptyState` | ‚úì |

### Improvements Checklist

- [x] Responsive grid breakpoints implemented (1x1, 2x2, 3x3, 4x4)
- [x] Camera status indicators (Live/Offline/Alert) with appropriate colors
- [x] Alert state has pulsing animation
- [x] Event log auto-scrolls to bottom
- [x] Pause auto-scroll on hover with visual indicator
- [x] Resume auto-scroll button when paused
- [x] Empty states with icons and helpful descriptions
- [x] Hover state on StreamCard with "Expand" button
- [x] Notification badge placeholder on Triage icon
- [ ] Consider extracting `StatCard` to separate file for reusability
- [ ] Add unit tests for `getGridColumns()` utility function
- [ ] Consider memoizing event rendering with `React.memo` for performance

### Security Review

‚úì **No security concerns** - This is a frontend UI story with no auth/payment/sensitive data handling. Mock data is appropriately used for development purposes.

### Performance Considerations

‚úì **Good practices observed:**
- Events array is capped at 50 items (line 94 in page.tsx)
- CSS Grid used for efficient layout rendering
- Resize event listener properly cleaned up
- `useRef` used for scroll container to avoid unnecessary re-renders

‚ö†Ô∏è **Minor optimization opportunity:**
- Event list items could use `React.memo` to prevent re-renders of unchanged events
- Not critical for current scope (50 events max)

### Files Modified During Review

None - no modifications were necessary.

### Gate Status

Gate: **PASS** ‚Üí docs/qa/gates/3.2-mission-control-dashboard-layout.yml

### Recommended Status

**‚úì Ready for Done**

All acceptance criteria are met with high-quality implementation. The Cyberpunk color palette is properly used, responsive behavior works correctly, and all UI components are well-structured and reusable. Minor improvements identified are optional enhancements for future sprints.
