# Story 3.7: UI Polish & Real Camera Validation

## Status
Done

## Story
**As a** Portfolio Presenter (and City Operator),
**I want** the dashboard to have consistently polished, premium styling and fully functional real-time features (Map, Camera Feeds),
**So that** the "Wow Factor" is undeniable and the system works without requiring API tokens or manual configuration.

## Context
Previous iterations have failed to meet the visual and functional quality bar. The "Cyberpunk" aesthetic is inconsistent, typography feels "off", and core features like the Map and Video Feeds are broken or rely on missing API keys.

**This is a remedial story.** We must fix the foundational UI/UX issues before moving forward.

## Acceptance Criteria

### 1. Functional City Map (Zero Config)
- [x] **Interactive Map Required**: The map MUST be an interactive, pannable tile map with pins.
- [x] **No Mapbox Tokens**: Replace `react-map-gl` with `react-leaflet` (OpenStreetMap) or another free provider to ensure it works "out of the box" for the user.
- [x] **Pins & Popups**: Camera locations must be clickable, showing status and details.

### 2. Reliable Video Feeds
- [x] **Real Streams**: The `StreamCard` must successfully play the HLS streams defined in the camera data.
- [x] **Error Handling**: If a stream fails (CORS, offline), a clean "Offline/Signal Lost" placeholder must display (no broken images).
- [x] **Props Usage**: `VideoPlayer` must respect the `streamUrl` prop passed to it.

### 3. Premium Aesthetics (Typography & Spacing)
- [x] **Fonts**: Implement `Orbitron` (Google Font) for all Headers/KPIs to enforce the Cyberpunk feel. Keep `Inter` for body text.
- [x] **Layout Audit**: Reset global padding. Ensure `MainLayout` handles the sidebar width consistently (no `calc` errors).
- [x] **Padding consistency**: All cards and containers must have consistent internal padding (e.g., `p-6`).

## Verification Plan
### Manual Verification
- **Visual Check**: Does the dashboard look "premium"? Are fonts distinct?
- **Map Check**: Can I drag the map? Do pins appear?
- **Stream Check**: Do the Iowa DOT cameras play video?

## QA Results

### Review Date: 2026-01-17 (Post-Rejection)
### Reviewed By: Quinn (Test Architect)

### Gate Status: FAIL

**Reason**: The previous "PASS" was revoked by the Product Owner. The application is visibly broken and aesthetically poor.

### Critical Failures:
1.  **Map is a Grid**: The user asked for a Map. Giving them a Grid because of "missing tokens" is a failure. **Fix**: Use Leaflet.
2.  **Video Feeds Broken**: Streams are not playing. `VideoPlayer` logic needs debugging.
3.  **"Ugly" UI**: The current font/spacing combination works on paper but looks bad in practice. **Fix**: Switch to Orbitron for headers, enforce strict padding.

### Required Actions for Dev:
- [x] **Uninstall** `react-map-gl` / `mapbox-gl`.
- [x] **Install** `leaflet`, `react-leaflet`.
- [x] **Update** `globals.css` / `layout.tsx` to load `Orbitron`.
- [x] **Refactor** `CityMap.tsx` to use Leaflet.
- [x] **Debug** `VideoPlayer.tsx` to ensure HLS playback works.

## QA Results

### Review Date: 2026-01-17 (Post-Fix Verification)
### Reviewed By: Quinn (Test Architect)

### Gate Status: PASS

### Code Quality Assessment
Excellent remediation of previous issues. 
- **Map Architecture**: Successfully migrated to Leaflet (OpenStreetMap) removing the dependency on Mapbox tokens. Dark mode implementation via CSS filter is efficient and matches the theme.
- **Video Playback**: HLS integration via `hls.js` is correctly implemented with robust error handling ("Signal Lost" UI).
- **Type Safety**: Refactored `CameraStatus` to generic lowercase ('online', 'offline', 'alert') to ensure consistency between Map and Dashboard components.

### Refactoring Performed
- **File**: `services/web-dashboard/src/components/ui/StreamCard.tsx`
  - **Change**: Updated status logic to use canonical lowercase types (`online`, `offline`, `alert`).
  - **Why**: Mismatch between `CityMap` (lowercase) and `StreamCard` (Capitalized) was causing potential runtime errors.
  - **How**: Aligned with `types/camera.ts`.
- **File**: `services/web-dashboard/src/app/page.tsx`
  - **Change**: Updated mock data types and values.
  - **Why**: To satisfy strict TS interfaces and ensure `VideoGrid` renders correctly.

### Compliance Check
- Coding Standards: [✓]
- Project Structure: [✓]
- Testing Strategy: [✓] (Manual verification of real HLS streams successful)
- All ACs Met: [✓]

### Gate Status
Gate: PASS → docs/qa/gates/3.7-ui-polish-real-camera-validation.yml

### Recommended Status
[✓ Ready for Done]
