# Story 1.1: Infrastructure Setup (K8s & ArgoCD)

## Status
Complete

## Story
**As a** DevOps Engineer,
**I want** to provision a local Kubernetes cluster and install ArgoCD,
**So that** I have a GitOps-ready environment for deploying my microservices.

## Acceptance Criteria
- [ ] Local K8s cluster (Minikube or K3s) is running and stable.
- [ ] ArgoCD is installed in the `argocd` namespace.
- [ ] `docs/architecture/source-tree.md` is updated to reflect the infra structure.
- [ ] A root `Application` (App of Apps) is configured in ArgoCD pointing to `k8s/`.

## Tasks / Subtasks
- [x] Initialize Infrastructure Code
    - [x] Create `infra/main.tf` for local K8s provisioning [Source: docs/architecture/tech-stack.md]
    - [x] Create `infra/variables.tf` [Source: docs/architecture/tech-stack.md]
    - [x] Ensure `.gitignore` ignores terraform state files.
- [x] Provision Cluster
    - [x] specific tasks to provision K3s/Minikube compatible with Terraform. [Source: docs/prd.md#NFR1]
- [x] Install ArgoCD
    - [x] Create `k8s/infra/argocd.yaml` (Namespace + Installation manifests/Helm release). [Source: docs/architecture/tech-stack.md]
    - [x] Deploy ArgoCD manually or via script to bootstrap.
- [x] Configure GitOps Root
    - [x] Create `k8s/root-application.yaml` (App of Apps pattern) pointing to project `k8s/` directory.
    - [x] Apply root application to ArgoCD.
- [x] Update Documentation
    - [x] Review and update `docs/architecture/source-tree.md` if directory structure diverged.

## Dev Notes
- **Architecture Compliance**:
    - **Infrastructure**: Must be defined as Code (Terraform) as per NFR4.
    - **Platform**: Local Kubernetes (Minikube or K3s) as per NFR1.
    - **Deployment**: user GitOps (ArgoCD) as per NFR5.
- **File Locations**:
    - Terraform code: `infra/`
    - Kubernetes Manifests: `k8s/`
- **Technical constraints**:
    - Use Redpanda and MinIO in subsequent stories, but ensure `k8s/` structure supports them.
    - Start with a clear `base` and `overlays` structure if using Kustomize, or standard Helm structure.

### Testing
- **Verification Commands**:
    - `terraform plan` / `apply`: Should succeed without errors.
    - `kubectl get nodes`: Should return ready nodes.
    - `kubectl get pods -n argocd`: Should show ArgoCD components running.
    - `kubectl get app`: Should show the root application synced.
- **Standards**:
    - No specific testing framework for Infra defined in architecture, use manual verification and command exit codes.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2026-01-15 | v1.0 | Initial Draft | Scrum Master |

## Dev Agent Record
### Agent Model Used
Gemini 2.0 Flash

### Debug Log References
- ArgoCD installation verified via kubectl
- Git remote verified

### Completion Notes List
- Infrastructure initialized with Terraform (`infra/`).
- ArgoCD installed in `argocd` namespace.
- Root Application (`root-app`) configured pointing to `k8s/`.
- Documentation updated (`source-tree.md`).

### File List
- infra/main.tf
- infra/variables.tf
- k8s/infra/argocd.yaml
- k8s/root-application.yaml
- docs/architecture/source-tree.md
- .gitignore

## QA Results
(To be filled)
